<div class="flex flex-col w-full h-[72vh]">
  <div class="flex flex-col flex-grow overflow-auto">
    @for (message of messageService.messageThread(); track message.id) {
      <div
        class="chat"
        [class.chat-start]="!message.currentUserSender"
        [class.chat-end]="message.currentUserSender"
      >
        <div
          class="chat-image avatar"
          [class.avatar-online]="
            presenceService.onlineUsers().includes(message.senderId || message.recipientId)
          "
        >
          <div class="w-10 rounded-full">
            <img alt="image of user" [src]="message.senderImageUrl || '/user.png'" />
          </div>
        </div>
        <div class="chat-header">
          {{ message.senderDisplayName }}
          <time class="text-xs opacity-50">{{ message.messageSent | date: 'short' }}</time>
        </div>
        <div class="chat-bubble">{{ message.content }}</div>
        @if (message.currentUserSender && message.dateRead) {
          <div class="chat-footer opacity-50">Seen {{ message.dateRead | timeAgo }}</div>
        } @else if (message.currentUserSender && !message.dateRead) {
          <div class="chat-footer opacity-50">Not read</div>
        } @else {
          <div class="chat-footer opacity-50">Delivered</div>
        }
      </div>
    }
    <div #messageEndRef></div>
  </div>

  <div class="flex items-center gap-2">
    <div class="relative w-full">
      <input
        [(ngModel)]="messageContent"
        class="input w-full pr-10"
        placeholder="Enter your message"
        (keydown.enter)="sendMessage()"
      />

      <div
        class="tooltip tooltip-left absolute top-1/2 right-1 -translate-y-1/2"
        data-tip="Get AI suggestion for message"
      >
        <button
          class="btn btn-ghost btn-sm"
          (click)="getAiSuggestion()"
          [disabled]="isGettingSuggestion()"
        >
          @if (isGettingSuggestion()) {
            <span class="loading loading-spinner"></span>
          } @else {
            âœ¨
          }
        </button>
      </div>
    </div>

    <button (click)="sendMessage()" type="submit" class="btn btn-primary">Send</button>
  </div>
</div>
